<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>A-Frame Orbit Control Example</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>
  </head>
  <body>
    <a-scene id="scene" background="color: #ECECEC">
      <!-- モデル -->
      <a-entity 
        gltf-model="img/more.glb"
        position="0 0 0"
        scale="2 2 2"
      ></a-entity>

      <!-- カメラ -->
      <a-entity id="cameraRig" position="0 1.6 3">
        <a-camera id="camera"></a-camera>
      </a-entity>

      <a-light type="ambient" intensity="1"></a-light>
      <a-light type="directional" position="0 1 1" intensity="1"></a-light>
    </a-scene>

    <script>
      AFRAME.registerComponent('custom-orbit-controls', {
        init: function () {
          const sceneEl = this.el.sceneEl;
          const cameraEl = sceneEl.camera.el;
          const renderer = sceneEl.renderer;
          const camera = sceneEl.camera;
          const controls = new THREE.OrbitControls(camera, renderer.domElement);

          controls.enableDamping = true;
          controls.dampingFactor = 0.1;

          // 操作制限
          controls.enableRotate = true;
          controls.enableZoom = true;
          controls.enablePan = true;

          // 回転の上限・下限
          controls.maxPolarAngle = Math.PI / 1.8;
          controls.minPolarAngle = Math.PI / 4;

          // 動作条件
          // 左クリック：何もしない
          // 右クリック：回転
          // 中クリック：平行移動
          controls.mouseButtons = {
            LEFT: null,
            MIDDLE: THREE.MOUSE.PAN,
            RIGHT: THREE.MOUSE.ROTATE,
          };

          // スクロールで拡大縮小
          controls.zoomSpeed = 1.0;

          this.controls = controls;

          this.el.sceneEl.addEventListener('render-target-loaded', () => {
            controls.update();
          });
        },
        tick: function () {
          this.controls.update();
        }
      });

      // カスタムコンポーネントをシーンに追加
      document.querySelector('#scene').setAttribute('custom-orbit-controls', '');
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3Dモデル VR（スマホ対応）</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <!-- ジェスチャー検出 -->
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-gesture-detector-component/dist/aframe-gesture-detector-component.min.js"></script>
</head>
<body>

<a-scene background="color: #87CEEB">

  <!-- モデル -->
  <a-entity id="model"
            gltf-model="https://770-3110.github.io/ar-test/img/more.glb"
            position="0 0 -3"
            rotation="0 180 0"
            scale="1 1 1"
            gesture-detector>
  </a-entity>

  <!-- カメラ（スマホでも固定） -->
  <a-entity camera
            look-controls="magicWindowTrackingEnabled: false"
            position="0 1.6 0">
  </a-entity>

  <!-- 光源 -->
  <a-entity light="type: ambient; intensity: 1"></a-entity>
  <a-entity light="type: directional; intensity: 0.8" position="3 5 2"></a-entity>

</a-scene>

<script>
  const model = document.querySelector('#model');

  model.addEventListener('pinch', function (event) {
    // event.detail.scale でピンチの倍率を取得
    const scale = model.getAttribute('scale');
    const newScale = scale.x * event.detail.scale; // x,y,z 同じ倍率にする
    model.setAttribute('scale', {x: newScale, y: newScale, z: newScale});
  });

  model.addEventListener('rotate', function (event) {
    // event.detail.rotation 回転量（ラジアン）
    const rot = model.getAttribute('rotation');
    model.setAttribute('rotation', {
      x: rot.x,
      y: rot.y + event.detail.positionChange[0],
      z: rot.z
    });
  });
</script>

</body>
</html>
